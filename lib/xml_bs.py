search_types_list = [{'__search_key__': u'sthpw/search_object?code=cgshort/characters',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/characters',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 84,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/characters',
  'table_name': u'characters',
  'title': u'Characters',
  'type': u'maya'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/cloth',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/cloth',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 101,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/cloth',
  'table_name': u'cloth',
  'title': u'Cloth',
  'type': u'houdini'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/dynamics',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/dynamics',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 99,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/dynamics',
  'table_name': u'dynamics',
  'title': u'Dynamics',
  'type': u'houdini'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/fluids',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/fluids',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 100,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/fluids',
  'table_name': u'fluids',
  'title': u'Fluids',
  'type': u'houdini'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/montage',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/montage',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 93,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/montage',
  'table_name': u'montage',
  'title': u'Montage',
  'type': u'nuke'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/precompose',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/precompose',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 92,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/precompose',
  'table_name': u'precompose',
  'title': u'Precompose',
  'type': u'nuke'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/props',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/props',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 83,
  'id_column': None,
  'message_event': u'insert|update|change',
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/props',
  'table_name': u'props',
  'title': u'Props',
  'type': u'maya'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/scenes',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/scenes',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 86,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/scenes',
  'table_name': u'scenes',
  'title': u'Scenes',
  'type': u'maya'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/sequence',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/sequence',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 91,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/sequence',
  'table_name': u'sequence',
  'title': u'Sequence',
  'type': u'nuke'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/sets',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/sets',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 85,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/sets',
  'table_name': u'sets',
  'title': u'Sets',
  'type': u'maya'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/shaders',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/shaders',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 96,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/shaders',
  'table_name': u'shaders',
  'title': u'Shaders',
  'type': u'maya'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/shot',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/shot',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 90,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/shot',
  'table_name': u'shot',
  'title': u'Shot',
  'type': u'maya'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/textures',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/textures',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 97,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/textures',
  'table_name': u'textures',
  'title': u'Textures',
  'type': u'maya'},
 {'__search_key__': u'sthpw/search_object?code=cgshort/vfx',
  'class_name': u'pyasm.search.SObject',
  'code': u'cgshort/vfx',
  'color': None,
  'database': u'{project}',
  'default_layout': u'table',
  'description': None,
  'id': 98,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'cgshort',
  'schema': u'public',
  'search_type': u'cgshort/vfx',
  'table_name': u'vfx',
  'title': u'VFX',
  'type': u'houdini'},
 {'__search_key__': u'sthpw/search_object?code=the_pirate/pirate',
  'class_name': u'pyasm.search.SObject',
  'code': u'the_pirate/pirate',
  'color': None,
  'database': u'the_pirate',
  'default_layout': u'table',
  'description': None,
  'id': 128,
  'id_column': None,
  'message_event': None,
  'metadata_parser': None,
  'namespace': u'the_pirate',
  'schema': u'public',
  'search_type': u'the_pirate/pirate',
  'table_name': u'pirate',
  'title': u'pirate',
  'type': u'maya'}]

pipeline_list = [{'__search_key__': u'sthpw/pipeline?code=the_pirate/characters',
  'autocreate_tasks': False,
  'code': u'the_pirate/characters',
  'color': None,
  'description': None,
  'id': 10,
  'name': None,
  'parent_process': None,
  'pipeline': u'<pipeline>\n  <process name="Concept"/>\n  <process name="Blocking"/>\n  <process name="Sculpt"/>\n  <process name="Modeling"/>\n  <process name="Texturing"/>\n  <process name="Hairs"/>\n  <process name="Dynamics"/>\n  <process name="Rigging"/>\n  <process name="Final"/>\n  <connect from="Concept" to="Blocking"/>\n  <connect from="Blocking" to="Sculpt"/>\n  <connect from="Sculpt" to="Modeling"/>\n  <connect from="Modeling" to="Texturing"/>\n  <connect from="Texturing" to="Hairs"/>\n  <connect from="Hairs" to="Dynamics"/>\n  <connect from="Dynamics" to="Rigging"/>\n  <connect from="Rigging" to="Final"/>\n</pipeline>\n',
  'project_code': u'the_pirate',
  's_status': None,
  'search_type': u'cgshort/characters',
  'timestamp': '2016-01-20 13:02:56'},
 {'__search_key__': u'sthpw/pipeline?code=the_pirate/props',
  'autocreate_tasks': False,
  'code': u'the_pirate/props',
  'color': None,
  'description': None,
  'id': 11,
  'name': None,
  'parent_process': None,
  'pipeline': u'<?xml version="1.0" encoding="UTF-8"?>\n<pipeline>\n  <process name="Refs" xpos="100" ypos="100" task_pipeline="exam/Refs"/>\n  <process name="Sculpt" xpos="258" ypos="264"/>\n  <process name="Modeling" xpos="375" ypos="433"/>\n  <process name="Texturing" xpos="556" ypos="425"/>\n  <process name="Final" xpos="678" ypos="255"/>\n  <connect from="Modeling" to="Texturing"/>\n  <connect from="Modeling" to="Final"/>\n  <connect from="Refs" to="Sculpt"/>\n  <connect from="Refs" to="Final"/>\n  <connect from="Sculpt" to="Modeling"/>\n  <connect from="Sculpt" to="Final"/>\n  <connect from="Texturing" to="Final"/>\n</pipeline>\n',
  'project_code': u'the_pirate',
  's_status': None,
  'search_type': u'cgshort/props',
  'timestamp': '2016-01-20 13:03:08'},
 {'__search_key__': u'sthpw/pipeline?code=the_pirate/scenes',
  'autocreate_tasks': False,
  'code': u'the_pirate/scenes',
  'color': None,
  'description': None,
  'id': 12,
  'name': None,
  'parent_process': None,
  'pipeline': u'<?xml version="1.0" encoding="UTF-8"?>\n<pipeline>\n  <process name="Blocking" xpos="100" ypos="100"/>\n  <process name="Camera" xpos="379" ypos="151"/>\n  <process name="Animation" xpos="648" ypos="173"/>\n  <process name="Lighting" xpos="846" ypos="194"/>\n  <connect from="Animation" to="Lighting"/>\n  <connect from="Blocking" to="Camera"/>\n  <connect from="Camera" to="Animation"/>\n</pipeline>\n',
  'project_code': u'the_pirate',
  's_status': None,
  'search_type': u'cgshort/scenes',
  'timestamp': '2016-01-20 13:03:13'},
 {'__search_key__': u'sthpw/pipeline?code=the_pirate/sets',
  'autocreate_tasks': False,
  'code': u'the_pirate/sets',
  'color': None,
  'description': None,
  'id': 13,
  'name': None,
  'parent_process': None,
  'pipeline': u'<?xml version="1.0" encoding="UTF-8"?>\n<pipeline>\n<process name="model">\n<action event="checkin/pre_export" scope="client"\nclass="pyasm.application.common.interpreter.MayaModelCheckinPreexport"/>\n</process>\n<process name="texture">\n<action event="checkin/pre_export" scope="client"\nclass="pyasm.application.common.interpreter.MayaTextureCheckinPreexport"/>\n<action event="checkin/process" scope="client"\nclass="pyasm.application.common.interpreter.MayaTextureCheckinProcess"/>\n</process>\n<process name="shader"/>\n<process name="rig"/>\n<connect to="texture" from="model" context="model"/>\n<connect to="shader" from="texture" context="texture"/>\n<connect to="shot/layout" from="rig" context="rig"/>\n<connect to="rig" from="texture" context="texture"/>\n<connect to="shot/lighting" from="shader"/>\n</pipeline>',
  'project_code': u'the_pirate',
  's_status': None,
  'search_type': u'cgshort/sets',
  'timestamp': '2016-01-20 13:29:34'}]

schema_str = """<?xml version="1.0" encoding="UTF-8"?>
<schema>
  <search_type name="cgshort/animatic" xpos="128" ypos="374"/>
  <search_type name="cgshort/art" xpos="1750" ypos="650"/>
  <search_type name="cgshort/characters" xpos="250" ypos="150"/>
  <search_type name="cgshort/cloth" xpos="2800" ypos="1000"/>
  <search_type name="cgshort/dynamics" xpos="2500" ypos="900"/>
  <search_type name="cgshort/fluids" xpos="2650" ypos="950"/>
  <search_type name="cgshort/montage" xpos="1600" ypos="600"/>
  <search_type name="cgshort/photo" xpos="1900" ypos="700"/>
  <search_type name="cgshort/precompose" xpos="1450" ypos="550"/>
  <search_type name="cgshort/props" xpos="100" ypos="100"/>
  <search_type name="cgshort/scenes" xpos="302" ypos="361"/>
  <search_type name="cgshort/script" xpos="850" ypos="350"/>
  <search_type name="cgshort/sequence" xpos="1300" ypos="500"/>
  <search_type name="cgshort/sets" xpos="466" ypos="351"/>
  <search_type name="cgshort/shaders" xpos="2050" ypos="750"/>
  <search_type name="cgshort/shot" xpos="301" ypos="507"/>
  <search_type name="cgshort/storyboard" xpos="1000" ypos="400"/>
  <search_type name="cgshort/textures" xpos="2200" ypos="800"/>
  <search_type name="cgshort/vfx" xpos="2350" ypos="850"/>
  <search_type name="the_pirate/pirate" xpos="2950" ypos="1050"/>
  <connect from="cgshort/animatic" to="cgshort/scenes" relationship="code" from_col="scenes_code" to_col="code"/>
  <connect from="cgshort/scenes" to="cgshort/sets" from_col="sets_code" to_col="code" relationship="code"/>
  <connect from="cgshort/shot" to="cgshort/scenes" relationship="code" from_col="scenes_code" to_col="code"/>
  <connect from="cgshort/shot" to="cgshort/sets" from_col="sets_code" to_col="code" relationship="code"/>
</schema>"""
from lib.bs4 import BeautifulSoup

# SType class
class SType(object):
    """
    Main class for search types
    """
    def __init__(self, in_stype=None):

        # INPUT VARS
        self.info = in_stype

        # OUTPUT VARS
        self.pipeline = {}
        self.schema = None

    def get_pipeline(self, in_pipeline=None):
        # print(in_pipeline)
        # print(self.info['code'])
        pipeline = BeautifulSoup(in_pipeline['pipeline'], 'html.parser')
        all_pipeline = []
        for pipe in pipeline.find_all('process'):
            all_pipeline.append(pipe['name'])
        # items[in_pipeline['search_type']] = all_pipeline
        self.pipeline['pipeline'] = all_pipeline
        print(self.pipeline['pipeline'])

    def get_schema(self, in_schema=None):
        pass


def get_stypes():

    stypes_dict = {}
    for stype in search_types_list:
        stypes_dict[stype['code']] = SType(stype)

    for pipe in pipeline_list:
        pipe_stype = pipe['search_type']
        if pipe_stype in stypes_dict.iterkeys():
            stypes_dict[pipe_stype].get_pipeline(pipe)
            # print(pipe['search_type'])
    # print(stypes_dict.iterkeys())

    return stypes_dict

stypes = get_stypes()
from pprint import pprint
# print(stypes['cgshort/shaders'].info)
import tactic_classes as tc

# pro = tc.server_start().query('cgshort/shot', [('scenes_code', 'SCENES00001'), ('or'), ('sets_code', 'SETS00001')])
pro = tc.server_start().query('cgshort/shot', [('code', 'in', 'SHOT00001')])
pprint(pro)

import lib.client.tactic_client_lib.interpreter.pipeline as ppline

pipeline = ppline.Pipeline(schema_str)